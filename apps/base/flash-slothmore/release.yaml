apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: flash-slothmore-release
  namespace: flash-slothmore
spec:
  interval: 1h # for drifting resources
  releaseName: flash-slothmore
  targetNamespace: flash-slothmore
  chartRef:
    kind: HelmChart
    name: one-chart
    namespace: flux-system
  install:
    createNamespace: false
    remediation:
      retries: 3
  upgrade:
    remediation:
      retries: 3
  values:
    homelab:
      category: apps
      realm: automation

    nameOverride: flash-slothmore

    image:
      repository: "ghcr.io/josimar-silva/flash-slothmore"
      tag: "0.3.2"
      pullPolicy: IfNotPresent
    
    imagePullSecrets:
      - name: ghcr-auth

    replicaCount: 1

    strategy:
      type: Recreate

    service:
      type: ClusterIP
      port: 8080

    resources:
      limits:
        cpu: 2
        memory: 3Gi
      requests:
        cpu: 1
        memory: 1Gi

    livenessProbe:
      httpGet:
        path: /health
        port: http
      initialDelaySeconds: 10
      periodSeconds: 10
      successThreshold: 1
      failureThreshold: 10

    readinessProbe:
      httpGet:
        path: /health
        port: http
      initialDelaySeconds: 5
      periodSeconds: 5
      successThreshold: 1
      failureThreshold: 10
