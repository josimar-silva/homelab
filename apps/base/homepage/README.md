# Homepage Dashboard

Production-ready deployment of [Homepage](https://gethomepage.dev/) - a modern, fully static, fast, secure and customizable application dashboard.

## Overview

Homepage is deployed in the `homepage` namespace with:
- Internal-only access via Gateway API HTTPRoute
- Kubernetes widget integration with RBAC permissions
- ConfigMap-based configuration management
- Health checks and resource limits

## Access

- **Internal URL**: https://homepage.internal.from-gondor.com
- **Port**: 3000 (HTTP)
- **Namespace**: homepage

## Configuration

Homepage configuration is managed through ConfigMaps generated by Kustomize from the following files:

### Configuration Files

1. **settings.yaml** - General dashboard settings
   - Title, theme, layout
   - Search configuration
   - Background and UI preferences

2. **services.yaml** - Service definitions and groupings
   - Organize services by category
   - Configure service icons, URLs, and health checks
   - Example services are pre-configured

3. **widgets.yaml** - Dashboard widgets
   - Kubernetes cluster information
   - Resource usage monitoring
   - Weather widget
   - DateTime and search

4. **bookmarks.yaml** - Quick access bookmarks
   - Development tools
   - Homelab resources
   - Monitoring platforms

### Modifying Configuration

To update Homepage configuration:

1. Edit the relevant YAML file(s) in this directory
2. Commit changes to git
3. FluxCD will automatically detect changes and update the ConfigMap
4. Homepage will reload the configuration automatically

## Kubernetes Integration

Homepage has read-only access to cluster resources via RBAC:

### ServiceAccount
- **Name**: homepage
- **Namespace**: homepage

### Permissions (ClusterRole)
Read-only access to:
- Cluster resources: nodes, namespaces
- Workload resources: pods, deployments, statefulsets, daemonsets, replicasets
- Services and networking: services, endpoints, ingresses, httproutes
- Storage: persistentvolumeclaims
- Jobs: jobs, cronjobs
- Metrics: node and pod metrics

## Resources

### Container Image
- **Repository**: ghcr.io/gethomepage/homepage
- **Tag**: v1.7.0

### Resource Limits
```yaml
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 200m
    memory: 256Mi
```

## Deployment Architecture

### Components
1. **Namespace** - Isolated namespace for Homepage
2. **ServiceAccount** - For Kubernetes API access
3. **ClusterRole/ClusterRoleBinding** - RBAC permissions
4. **ConfigMap** - Application configuration (auto-generated from YAML files)
5. **HelmRelease** - Deploys via one-chart with custom values
6. **HTTPRoute** - Gateway API routing for internal access

### Chart
Uses the homelab's generic `one-chart` Helm chart with:
- Service account injection via postRenderer (kustomize patch)
- ConfigMap volume mounting to `/app/config`
- Health probes on `/api/healthcheck`
- Rolling update strategy

## Health Checks

### Liveness Probe
- Path: `/api/healthcheck`
- Initial delay: 10s
- Period: 10s
- Failure threshold: 10

### Readiness Probe
- Path: `/api/healthcheck`
- Initial delay: 5s
- Period: 5s
- Failure threshold: 10

## Security

### Service Account
The deployment uses a dedicated ServiceAccount with minimal required permissions (read-only cluster access).

### Network Access
- Internal-only access via Gateway API
- No external exposure (cloudflared disabled)
- Communicates with Kubernetes API server for widget data

### Pod Security
- ReadOnly volume mounts for configuration
- Non-privileged container (default)

## Files

```
homepage/
├── README.md           # This file
├── namespace.yaml      # Namespace definition
├── rbac.yaml          # ServiceAccount, ClusterRole, ClusterRoleBinding
├── release.yaml       # HelmRelease with one-chart configuration
├── kustomization.yaml # Kustomize configuration with ConfigMap generator
├── settings.yaml      # Homepage settings configuration
├── services.yaml      # Service definitions
├── widgets.yaml       # Dashboard widgets configuration
└── bookmarks.yaml     # Bookmarks configuration
```

## Troubleshooting

### Check Pod Status
```bash
kubectl get pods -n homepage
kubectl describe pod -n homepage -l app.kubernetes.io/name=homepage
```

### View Logs
```bash
kubectl logs -n homepage -l app.kubernetes.io/name=homepage
```

### Verify ConfigMap
```bash
kubectl get configmap homepage-config -n homepage
kubectl describe configmap homepage-config -n homepage
```

### Check RBAC
```bash
kubectl get sa,clusterrole,clusterrolebinding -n homepage
kubectl auth can-i get pods --as=system:serviceaccount:homepage:homepage
```

### Test HTTPRoute
```bash
kubectl get httproute -n homepage
kubectl describe httproute -n homepage
```

## Links

- [Homepage Documentation](https://gethomepage.dev/)
- [Homepage GitHub](https://github.com/gethomepage/homepage)
- [Configuration Options](https://gethomepage.dev/latest/configs/)
- [Widget Documentation](https://gethomepage.dev/latest/widgets/)
