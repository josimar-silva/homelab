---
apiVersion: v1
kind: ConfigMap
metadata:
  name: smaug-config
  namespace: smaug
  labels:
    app.kubernetes.io/name: smaug
    app.kubernetes.io/component: configuration
    middle-earth-cluster.homelab/category: apps
    middle-earth-cluster.homelab/realm: networking
data:
  smaug.yaml: |
    # Global Configuration
    settings:
      # Logging configuration
      logging:
        level: info   
        format: json 

      gwaihir:
        url: "http://gwaihir.gwaihir.svc.cluster.local:9600"
        apiKey: "${GWAIHIR_API_KEY}"
        timeout: 5s
      
      # Observability configuration
      observability:
        healthCheck:
          enabled: true
          port: 9091
        metrics:
          enabled: true
          port: 9090

    # Servers definitions
    servers:
      saruman:      
        wakeOnLan:
          enabled: true
          timeout: 60s
          debounce: 5s 

        sleepOnLan:
          enabled: true
          endpoint: "http://saruman.from-gondor.com:8009/sleep"
          authToken: "${SLEEP_ON_LAN_TOKEN}"
          idleTimeout: 5m
        
        healthCheck:
          endpoint: "http://saruman.from-gondor.com:8009/state/local"
          interval: 10s
          timeout: 2s

    # Routes definitions (port-per-service)
    routes:
      - name: ollama
        listen: 11434
        upstream: "http://saruman.from-gondor.com:11434"
        server: saruman
