apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: speedtest-tracker-db
  namespace: cnpg-system
spec:
  interval: 1h
  releaseName: speedtest-tracker-db
  targetNamespace: cnpg-system
  
  chartRef:
    kind: HelmChart
    name: postgresql-cluster
    namespace: flux-system
  
  install:
    createNamespace: false
    remediation: 
      retries: 3
  
  upgrade:
    remediation:
      retries: 3
  
  values:
    nameOverride: speedtest-tracker-db

    instances: 1

    postgresql:
      database:
        name: speedtest_tracker
        owner: speedy
      onepassword:
        enabled: true
        item: "[Database] Speedtest Tracker"
        secretName: speedtest-tracker-db
    
    storage:
      size: 10Gi
      storageClass: "longhorn-database-sc"

    loadBalancer:
      hostname: "speedtest-db.from-gondor.com"
      ipPool: "homelab-database-pool"

    resources:
      requests:
        cpu: 150m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi
